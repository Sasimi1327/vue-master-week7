import{S as b}from"./sweetalert2.all-Iirqrf_Y.js";import{M as w,P as $,R as C}from"./RemoveModal-ZvcGiJOC.js";import{_ as y,o,c as l,b as e,t as s,i as M,F as h,k as f,w as D,l as P,r as _,e as p,n as E}from"./index-mPaIGUPY.js";const T={props:["order"],data(){return{bsOrderModal:null,selectOrder:{}}},watch:{order(){this.selectOrder={...this.order}}},methods:{showModal(){this.bsOrderModal.show()},hideModal(){this.bsOrderModal.hide()}},mounted(){this.bsOrderModal=new w(this.$refs.orderModal)}},S={id:"orderModal",ref:"orderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},V={class:"modal-dialog modal-xl"},R={class:"modal-content border-0"},B=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{id:"productModalLabel",class:"modal-title"},[e("span",null,"訂單明細")]),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),U={class:"modal-body"},I={class:"row"},A={class:"col-md-4"},N=e("h3",null,"用戶資料",-1),z={class:"table"},K={key:0},j=e("th",null,"姓名：",-1),q=e("th",null,"電子郵件：",-1),F=e("th",null,"電話：",-1),H=e("th",null,"地址：",-1),W=e("th",null,"顧客留言：",-1),G={class:"col-md-8"},J=e("h3",null,"訂單明細",-1),Q={class:"table"},X=e("th",{style:{width:"100px"}},"訂單編號",-1),Y=e("th",{style:{width:"100px"}},"下單時間",-1),Z=e("th",null,"付款狀態",-1),ee={key:0,class:"text-success"},te={key:1,class:"text-muted"},se=e("th",null,"總金額",-1),oe=e("h3",null,"選購商品",-1),le={class:"table"},ne={class:"text-end"},de={class:"d-flex justify-content-end"},ie={class:"form-check"},re={class:"form-check-label",for:"isPaidCheck"},ae={key:0},ce={key:1},ue={class:"modal-body d-flex justify-content-end"},he=e("button",{type:"button",class:"btn btn-outline-secondary me-2","data-bs-dismiss":"modal"}," 取消 ",-1);function _e(d,n,r,m,t,c){return o(),l("div",S,[e("div",V,[e("div",R,[B,e("div",U,[e("div",I,[e("div",A,[N,e("table",z,[t.selectOrder.user?(o(),l("tbody",K,[e("tr",null,[j,e("td",null,s(t.selectOrder.user.name),1)]),e("tr",null,[q,e("td",null,s(t.selectOrder.user.email),1)]),e("tr",null,[F,e("td",null,s(t.selectOrder.user.tel),1)]),e("tr",null,[H,e("td",null,s(t.selectOrder.user.address),1)]),e("tr",null,[W,e("td",null,s(t.selectOrder.message?t.selectOrder.message:"無"),1)])])):M("",!0)])]),e("div",G,[J,e("table",Q,[e("tbody",null,[e("tr",null,[X,e("td",null,s(t.selectOrder.id),1)]),e("tr",null,[Y,e("td",null,s(new Date(r.order.create_at*1e3).toLocaleDateString("zh-TW")),1)]),e("tr",null,[Z,e("td",null,[t.selectOrder.is_paid?(o(),l("span",ee,"已付款")):(o(),l("span",te,"未付款"))])]),e("tr",null,[se,e("td",null,s(t.selectOrder.total)+" 元 ",1)])])]),oe,e("table",le,[e("tbody",null,[(o(!0),l(h,null,f(t.selectOrder.products,a=>(o(),l("tr",{key:a.id},[e("th",null,s(a.product.title),1),e("td",null,s(a.qty)+s(a.product.unit),1),e("td",ne,"NT$ "+s(a.total),1)]))),128))])]),e("div",de,[e("div",ie,[D(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"isPaidCheck","onUpdate:modelValue":n[0]||(n[0]=a=>t.selectOrder.is_paid=a)},null,512),[[P,t.selectOrder.is_paid]]),e("label",re,[t.selectOrder.is_paid?(o(),l("span",ae,"已付款")):(o(),l("span",ce,"未付款"))])])])])])]),e("div",ue,[he,e("button",{type:"button",class:"btn btn-primary",onClick:n[1]||(n[1]=a=>d.$emit("update-order",t.selectOrder))}," 確認 ")])])])],512)}const pe=y(T,[["render",_e]]);var me={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"sasimi2024",BASE_URL:"/vue-master-week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:g,VITE_PATH:O}=me,be={data(){return{orders:[],pages:{},selectOrder:{},isLoading:!1}},methods:{getOrders(d=1){const n=`${g}/api/${O}/admin/orders?page=${d}`;this.isLoading=!0,this.$http.get(n).then(r=>{this.orders=r.data.orders,this.pages=r.data.pagination,this.isLoading=!1}).catch(r=>{this.isLoading=!1,b.fire({icon:"error",title:`錯誤 ${r.response.status}`,text:r.response.data.message,confirmButtonText:"OK"})})},updatePaidStatus(d){const n=`${g}/api/${O}/admin/order/${this.selectOrder.id}`,r={is_paid:d.is_paid};this.$http.put(n,{data:r}).then(m=>{this.isLoading=!1,this.getOrders(this.pages.current_page),this.$refs.oModal.hideModal(),b.fire({icon:"success",title:m.data.message,confirmButtonText:"OK"})})},deleteOrder(){const d=`${g}/api/${O}/admin/order/${this.selectOrder.id}`;this.$http.delete(d).then(()=>{this.isLoading=!1,this.getOrders(this.pages.current_page),this.$refs.delModal.hideModal()}).catch(n=>{this.isLoading=!1,b.fire({icon:"error",title:`錯誤 ${n.response.status}`,text:n.response.data.message,confirmButtonText:"OK"})})},openEditModal(d){this.selectOrder={...d};//! [註]: 2. 這邊的 $refs 是綁定在元件上，父元件可透過 $refs 取得子元件內的資料和方法
this.$refs.oModal.showModal()},openDeleteModal(d){this.selectOrder={...d};//! [註]: 2. 這邊的 $refs 是綁定在元件上，父元件可透過 $refs 取得子元件內的資料和方法
this.$refs.delModal.showModal()}},components:{PaginationComponent:$,OrderModal:pe,RemoveModal:C},mounted(){this.getOrders()}},ge={class:"container"},Oe={class:"table mt-4"},fe=e("thead",null,[e("tr",null,[e("th",null," 購買時間 "),e("th",null," 電子郵件 "),e("th",null," 購買款項 "),e("th",{class:"text-center"}," 應付金額 "),e("th",null," 是否付款 "),e("th",{class:"text-center"}," 編輯 ")])],-1),ye={class:"list-unstyled"},Me={class:"text-center"},ve={key:0,class:"text-success text-end"},ke={key:1,class:"text-end"},xe={class:"btn-group"},Le=["onClick"],we=["onClick"];function $e(d,n,r,m,t,c){const a=_("VueLoading"),v=_("PaginationComponent"),k=_("OrderModal"),x=_("RemoveModal");return o(),l(h,null,[e("div",ge,[p(a,{active:t.isLoading,"onUpdate:active":n[0]||(n[0]=i=>t.isLoading=i)},null,8,["active"]),e("table",Oe,[fe,e("tbody",null,[(o(!0),l(h,null,f(t.orders,i=>(o(),l(h,{key:i.id},[t.orders.length?(o(),l("tr",{key:0,style:E({backgroundColor:i.is_paid?"lightblue":""})},[e("td",null,s(new Date(i.create_at*1e3).toLocaleDateString("zh-TW")),1),e("td",null,s(i.user.email),1),e("td",null,[e("ul",ye,[(o(!0),l(h,null,f(i.products,(u,L)=>(o(),l("li",{key:L},s(u.product.title)+" / "+s(u.qty)+s(u.product.unit),1))),128))])]),e("td",Me,s(i.total),1),e("td",null,[i.is_paid?(o(),l("span",ve,"已付款")):(o(),l("span",ke,"未付款"))]),e("td",null,[e("div",xe,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:u=>c.openEditModal(i)}," 檢視 ",8,Le),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:u=>c.openDeleteModal(i)}," 刪除 ",8,we)])])],4)):M("",!0)],64))),128))])]),p(v,{pages:t.pages,onEmitPages:c.getOrders},null,8,["pages","onEmitPages"])]),p(k,{ref:"oModal",order:t.selectOrder,onUpdateOrder:c.updatePaidStatus},null,8,["order","onUpdateOrder"]),p(x,{ref:"delModal",item:t.selectOrder,onDelItem:c.deleteOrder},null,8,["item","onDelItem"])],64)}const Ee=y(be,[["render",$e]]);export{Ee as default};
