import{S as _}from"./sweetalert2.all-Iirqrf_Y.js";import{_ as v,r as u,o as i,c as d,b as e,w as m,v as b,e as r,l as w,a as L,F as M,k as V,t as C}from"./index-mPaIGUPY.js";import{M as D,P as $,R as E}from"./RemoveModal-ZvcGiJOC.js";const U={props:["selectCoupon"],watch:{selectCoupon(){this.tempCoupon=this.selectCoupon,this.due_date=new Date(this.tempCoupon.due_date*1e3).toLocaleDateString()},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},data(){return{bsCouponModal:null,tempCoupon:{},due_date:""}},methods:{showModal(){this.bsCouponModal.show()},hideModal(){this.bsCouponModal.hide()},rangeCheck(s){const t=s.target.value;Number.parseInt(t,10)>100?this.tempCoupon.percent=100:Number.parseInt(t,10)<0&&(this.tempCoupon.percent=0)}},mounted(){this.bsCouponModal=new D(this.$refs.couponModal)}},P={id:"couponModal",ref:"couponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},T={class:"modal-dialog modal-xl"},R={class:"modal-content border-0"},I={class:"modal-header bg-dark text-white"},S={id:"couponModalLabel",class:"modal-title"},B={key:0},N={key:1},O=e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),A={class:"modal-body"},K={class:"row"},F={class:"mb-3"},H=e("label",{for:"title",class:"form-label"},"標題",-1),j={class:"mb-3"},q=e("label",{for:"coupon_code",class:"form-label"},"優惠碼",-1),z={class:"mb-3"},W=e("label",{for:"due_date",class:"form-label"},"到期日",-1),G={class:"mb-3"},J=e("label",{for:"discount",class:"form-label"},"折扣(百分比)",-1),Q={class:"d-flex justify-content-end"},X={class:"form-check"},Y={class:"form-check-label",for:"is_enabled"},Z={key:0,class:"text-success"},ee={key:1},te={class:"modal-footer"},oe=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function se(s,t,l,c,o,p){const h=u("VueDatePicker");return i(),d("div",P,[e("div",T,[e("div",R,[e("div",I,[e("h5",S,[o.tempCoupon.id?(i(),d("span",B,"編輯優惠券")):(i(),d("span",N,"新增優惠券"))]),O]),e("div",A,[e("div",K,[e("div",F,[H,m(e("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":t[0]||(t[0]=n=>o.tempCoupon.title=n)},null,512),[[b,o.tempCoupon.title]])]),e("div",j,[q,m(e("input",{id:"coupon_code",type:"text",class:"form-control",placeholder:"請輸入優惠碼","onUpdate:modelValue":t[1]||(t[1]=n=>o.tempCoupon.code=n)},null,512),[[b,o.tempCoupon.code]])]),e("div",z,[W,r(h,{modelValue:o.due_date,"onUpdate:modelValue":t[2]||(t[2]=n=>o.due_date=n),"min-date":new Date,"enable-time-picker":!1},null,8,["modelValue","min-date"])]),e("div",G,[J,m(e("input",{id:"discount",type:"number",min:"0",max:"100",onChange:t[3]||(t[3]=(...n)=>p.rangeCheck&&p.rangeCheck(...n)),class:"form-control",placeholder:"請輸入折扣百分比","onUpdate:modelValue":t[4]||(t[4]=n=>o.tempCoupon.percent=n)},null,544),[[b,o.tempCoupon.percent]])])]),e("div",Q,[e("div",X,[m(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,id:"is_enabled","onUpdate:modelValue":t[5]||(t[5]=n=>o.tempCoupon.is_enabled=n)},null,512),[[w,o.tempCoupon.is_enabled]]),e("label",Y,[o.tempCoupon.is_enabled?(i(),d("span",Z,"已啟用")):(i(),d("span",ee,"未啟用"))])])])]),e("div",te,[oe,e("button",{type:"button",class:"btn btn-primary",onClick:t[6]||(t[6]=n=>s.$emit("update-coupon",o.tempCoupon))}," 確認 ")])])])],512)}const ne=v(U,[["render",se]]);var le={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"sasimi2024",BASE_URL:"/vue-master-week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:f,VITE_PATH:g}=le,ae=`${f}/api/${g}/admin/coupon`,ie={data(){return{coupons:[],selectCoupon:{title:"",code:"",due_date:"",is_enabled:0,percent:100},pages:{},isLoading:!1,isNew:!1}},methods:{getCoupons(s=1){const t=`${f}/api/${g}/admin/coupons?page=${s}`;this.isLoading=!0,this.$http.get(t).then(l=>{this.isLoading=!1,this.coupons=l.data.coupons,this.pages=l.data.pagination}).catch(l=>{this.isLoading=!1,_.fire({icon:"error",title:`錯誤 ${l.response.status}`,text:l.response.data.message,confirmButtonText:"OK"})})},updateCoupon(s){const t=`${ae}/${this.selectCoupon.id?this.selectCoupon.id:""}`,l={data:s},c=this.selectCoupon.id?"put":"post";L[c](t,l).then(()=>{this.$refs.cpsModal.hideModal(),this.getCoupons(this.pages.current_page),this.selectCoupon={title:"",code:"",due_date:"",is_enabled:0,percent:100}}).catch(o=>{_.fire({icon:"error",title:`錯誤 ${o.response.status}`,text:o.response.data.message,confirmButtonText:"OK"})})},deleteCoupon(){const s=`${f}/api/${g}/admin/coupon/${this.selectCoupon.id}`;this.isLoading=!0,this.$http.delete(s).then(()=>{this.isLoading=!1,this.getCoupons(this.pages.current_page),this.$refs.delModal.hideModal()}).catch(t=>{var l,c;this.isLoading=!1,_.fire({icon:"error",title:`錯誤 ${(l=t.response)==null?void 0:l.status}`,text:(c=t.response)==null?void 0:c.data.message,confirmButtonText:"OK"})})},openNewModal(){this.selectCoupon={is_enabled:0};//! [註]: 2. 這邊的 $refs 是綁定在元件上，父元件可透過 $refs 取得子元件內的資料和方法
this.$refs.cpsModal.showModal()},openEditModal(s){this.selectCoupon={...s};//! [註]: 2. 這邊的 $refs 是綁定在元件上，父元件可透過 $refs 取得子元件內的資料和方法
this.$refs.cpsModal.showModal()},openDeleteModal(s){this.selectCoupon={...s};//! [註]: 2. 這邊的 $refs 是綁定在元件上，父元件可透過 $refs 取得子元件內的資料和方法
this.$refs.delModal.showModal()}},components:{PaginationComponent:$,CouponModal:ne,RemoveModal:E},mounted(){this.getCoupons()}},de={class:"container"},pe={class:"text-end mt-4"},ce={class:"table mt-4"},ue=e("thead",null,[e("tr",null,[e("th",null,"名稱"),e("th",null,"到期日"),e("th",null,"折扣百分比"),e("th",null,"是否啟用"),e("th",null,"編輯")])],-1),re={key:0,class:"text-success text-end"},me={key:1,class:"text-end"},he={class:"btn-group"},_e=["onClick"],be=["onClick"];function Ce(s,t,l,c,o,p){const h=u("VueLoading"),n=u("PaginationComponent"),k=u("CouponModal"),x=u("RemoveModal");return i(),d(M,null,[e("div",de,[r(h,{active:o.isLoading,"onUpdate:active":t[0]||(t[0]=a=>o.isLoading=a)},null,8,["active"]),e("div",pe,[e("button",{type:"button",class:"btn btn-primary",onClick:t[1]||(t[1]=a=>p.openNewModal())}," 建立新的優惠券 ")]),e("table",ce,[ue,e("tbody",null,[(i(!0),d(M,null,V(o.coupons,a=>(i(),d("tr",{key:a.id},[e("td",null,C(a.title),1),e("td",null,C(new Date(a.due_date*1e3).toLocaleDateString("zh-TW")),1),e("td",null,C(a.percent),1),e("td",null,[a.is_enabled?(i(),d("span",re,"已啟用")):(i(),d("span",me,"未啟用"))]),e("td",null,[e("div",he,[e("button",{type:"button",onClick:y=>p.openEditModal(a),class:"btn btn-outline-primary btn-sm"}," 編輯 ",8,_e),e("button",{type:"button",onClick:y=>p.openDeleteModal(a),class:"btn btn-outline-danger btn-sm"}," 刪除 ",8,be)])])]))),128))])]),r(n,{pages:o.pages,onEmitPages:p.getCoupons},null,8,["pages","onEmitPages"])]),r(k,{"select-coupon":o.selectCoupon,onUpdateCoupon:p.updateCoupon,ref:"cpsModal"},null,8,["select-coupon","onUpdateCoupon"]),r(x,{ref:"delModal",item:o.selectCoupon,onDelItem:p.deleteCoupon},null,8,["item","onDelItem"])],64)}const ve=v(ie,[["render",Ce]]);export{ve as default};
